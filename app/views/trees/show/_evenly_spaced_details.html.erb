<% detail_order = [] %>
<% if table_depth
  detail_title, detail_code, edit_type, action, category_arr = title_code_type_action_catsArr[0]
  table_name = detail_title.length > 0 ? detail_title : get_category_title(category_arr[0], detail_code)
  table_code = "#{table_name.downcase.gsub(" ", "")}-#{table_depth}"
  table_name = "#{etcetera(table_name)}" if title_code_type_action_catsArr.length > 1
%>
   <button class="margin-left btn btn-link block show-btn <%= table_code %> js-show-hide-control" data-show-selector='.related-items-table.<%= table_code %>' data-hide-selector='.show-btn.<%= table_code %>'>[  <%= I18n.translate('app.labels.show_indicators', name: table_name) %>]</button>
<% end %>
<div class='related-items-table<%= table_name ? " hidden #{table_code} col-8" : "" %>'>
  <div class='row <%= table_name ? "colorful-header colorful-header-#{table_depth}" : "center-label-bold top-label" %> generic-grid generic-grid--cols-<%= num_cols %>'>
    <% title_code_type_action_catsArr.each do |arr|
      detail_title, detail_code, edit_type, action, category_arr = arr
      detail_order << detail_code
    %>
      <% if detail_title.length > 1 %>
      <div class='dark-border--left padding-right padding-left'>
        <%= detail_title %>
        <%= link_to(fa_icon("plus-square"), edit_tree_path(@tree.id, tree: { edit_type: edit_type, attr_id: 'new'}), {:remote => true, :class => "fa-lg pull-right", 'data-toggle' =>  "modal", 'data-target' => '#modal_popup'}) if @editMe && (action == 'create') && can_edit
         %>
         <% if table_depth %>
            <button class="margin-left btn btn-link hide-btn <%= table_code %> js-show-hide-control" data-hide-selector='.related-items-table.<%= table_code %>' data-show-selector='.show-btn.<%= table_code %>'>[  <%= I18n.translate('app.labels.hide_indicators', name: table_name) %>]</button>
          <% end %>
      </div>
      <% end %>
      <% if category_arr
        category_arr.each do |cat|
          category_title = get_category_title(cat, detail_code)
      %>
        <div class='dark-border--left padding-right padding-left'>
          <%= "#{detail_title.length > 0 ? "#{detail_title}: " : ""}#{category_title}" %>
          <% if table_depth %>
            <button class="margin-left btn btn-link hide-btn <%= table_code %> js-show-hide-control" data-hide-selector='.related-items-table.<%= table_code %>' data-show-selector='.show-btn.<%= table_code %>'>[  <%= I18n.translate('app.labels.hide_indicators', name: category_title) %>]</button>
          <% end %>
        </div>
      <%  end # category_codes.each do |code|
         end # if category_codes %>
    <% end # title_type_action_catsArr_detailArr.each do |arr|%>
  </div>
  <!--End of headers-->
  <!--Start table content-->
  <% [*0..(num_rows.to_i-1)].each do |ix| %>
    <div class='row'>
      <div class='dark-border generic-grid generic-grid--cols-<%= num_cols %>'>
        <% detail_order.each do |detail_code| %>
            <%
              parent = parents[ix]
              detail = @detailsHash[detail_code][ix] if (detailsHash[detail_code] && !parent)
              detail = @parents_by_depth["p#{parents[ix].id}"]["dims"][detail_code][0].dim_trees.group_by(&:tree_id)[parent.id][0] if parent && @parents_by_depth["p#{parents[ix].id}"]["dims"][detail_code]
              partial_path = "/trees/show/#{@editTypes[detail_code][:name]}"
            %>
            <%=
              render partial: partial_path, locals: {
                details: detail,
                detail_title: detail_code,
                type_code: detail_code,
                category_codes: @editTypes[detail_code][:codes],
                render_label: false,
                can_edit: can_edit_type?(detail_code) || current_user.subject_admin?(@subject_code),
                parent: parents[ix]
               }
            %>

        <% end %>
      </div>
    </div>
  <% end %>
</div>